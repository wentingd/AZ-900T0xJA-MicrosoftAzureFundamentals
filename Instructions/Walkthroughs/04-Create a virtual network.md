---
wts:
    title: '04 - 仮想ネットワークの作成 (20 分)'
    module: 'モジュール 02 - Azure のコア サービス (ワークロード)'
---
# 04 - 仮想ネットワークの作成 (20 分)

このチュートリアルでは、仮想ネットワークを作成し、その仮想ネットワークに 2 台の仮想マシンをデプロイして、仮想ネットワーク経由で一方の仮想マシンから他方の仮想マシンに ping を実行できるように構成します。

# タスク 1: 仮想ネットワークを作成する 

このタスクでは、仮想ネットワークを作成します。 

1. Azure portal　(`https://portal.azure.com`)  にサインインします。

2. 「**すべてのサービス**」ブレードで「**仮想ネットワーク**」を検索して選択し、**「+ 追加」、「+ 作成」、「+ 新規」** のいずれかをクリックします。 

3. 「**基本**」タブで、次の情報を入力します (その他の情報は既定値のままにします)。

    | 設定 | 値 | 
    | --- | --- |
    | サブスクリプション | **既定のままにする** |
    | リソース グループ | **新しいリソース グループの作成** |
    | 名前 | **vnet1** |
    | リージョン | **(米国) 米国東部** |
    
   
4. 「**確認および作成**」ボタンをクリックします。検証できたことを確認します。次に、作成を押してリソースをデプロイします。


# タスク 2: 2 つの仮想マシンを作成する

このタスクでは、仮想ネットワークに 2 つの仮想マシンを作成します。 

1. 「**すべてのサービス**」ブレードで「**仮想マシン**」を検索し、**「+ 追加」、「+　作成」、「+　新規」** の順にクリックして、「**仮想マシン**」を選択します。 

2. 「**基本**」タブで、次の情報を入力します (その他の情報は既定値のままにします)。

   | 設定 | 値 | 
   | --- | --- |
   | サブスクリプション | **提供されている既定値を使用** |
   | リソース グループ |  **ドロップダウンで既定値を選択** |
   | 仮想マシン名 | **vm1**|
   | リージョン | **(米国) 米国東部** |
   | イメージ | **Windows Server 2019 Datacenter - Gen1** |
   | ユーザー名| **azureuser** |
   | パスワード| **Pa$$w0rd1234** |
   | パブリック受信ポート| 「**選択したポートを許可する**」 を選択します  |
   | 選択した受信ポート| **RDP (3389)** |
   

3. 「**ネットワーク**」タブを選択します。仮想マシンが **vnet1** 仮想ネットワークに配置されていることを確認します。既定の設定を確認しますが、他の変更は行わないでください。 

4. 「**確認および作成**」 をクリックします。検証ができたら、 「**作成**」 をクリックします。デプロイにかかる時間は場合により異なりますが、通常 3 分から 6 分かかる可能性があります。

5. デプロイを監視しながら、次の手順に進みます。 

6. 上記の手順 **2~4** を繰り返して、2 番目の仮想マシンを作成します。別の仮想マシン名を使用していて、その仮想マシンが新しい仮想ネットワークにあり、新しいパブリック IP アドレスを使用していることを確認してください。

    | 設定 | 値 |
    | --- | --- |
    | リソース グループ | **myRGVNet** |
    | 仮想マシン名 |  **vm2** |
    | バーチャル ネットワーク | **vnet1** |
    | パブリック IP | **vm2-ip** |

7. 両方の仮想マシンがデプロイされ、ステータスが「*実行中*」と表示されるのを待ちます。

# タスク 3: 接続をテストする 

このタスクでは、仮想マシンが相互に通信 (ping）) きるかどうかをテストします。そうでない場合は、ICMP 接続を許可するルールをインストールします。通常、ICMP 接続は自動的にブロックされます。

1. 「**すべてのリソース**」 ブレードで、**vm1** を検索して 「**概要**」 ブレードを開き、 「**状態**」 が 「**実行中**」 であることを確認します。ページを**更新**する必要がある場合があります。

2. **「概要」** ブレードで、**「接続」** を選択して、ドロップダウンから **「RDP」** を選びます。

    **注**: 次の手順では、Windows コンピューターから VM に接続する方法を説明しています。 

3. 「**RDP で接続**」ブレードで、ポート 3389 経由で IP アドレスで接続する既定のオプションを保持し、「**RDP ファイルのダウンロード**」をクリックします。

4. ダウンロードした RDP ファイル (VM の左下にあります) を開き、プロンプトが表示されたら 「**接続**」 をクリックします。 

5. 「**Windows セキュリティ**」 ウィンドウで、ユーザー名 「**azureuser**」 とパスワード 「**Pa$$w0rd1234**」 を入力し、 「**OK**」 をクリックします。

6. サインイン プロセス中に証明書の警告が表示されることがあります。「**はい**」をクリックして、接続を作成してデプロイした VM に接続します。正常に接続されるはずです。ポップアップ表示される Windows Server ウィンドウとダッシュボード ウィンドウを閉じます。青い Windows の背景が表示されます。これで、仮想マシンが作成されました。

7. 「**スタート**」 ボタンをクリックして仮想マシンで PowerShell を開き、検索タイプ **PowerShell** で、**Windows PowerShell** を右クリックして**管理者として実行します**

8. Powershell で、次のように入力して vm2 に ping を実行してみます。

   ```PowerShell
   ping vm2
   ```

 9. 成功するはずです。VM1 から VM2 に ping を実行しました。


**お疲れさまでした!** 仮想ネットワークに 2 つの仮想マシンを構成してデプロイし、それらを接続できるようになりました。

**注**: 追加コストを回避するために、オプションでこのリソース グループを削除できます。リソース グループを検索し、リソース グループをクリックして、「**リソース グループの削除**」をクリックします。リソース グループの名前を確認し、「**削除**」をクリックします。**通知**を監視して、削除の進行状況を確認します。
